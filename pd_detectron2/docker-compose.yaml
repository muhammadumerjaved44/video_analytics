version: '2.3'

# list of services in the Docker
services:

  # detectron2 container configuration
  pd-detectron2:
    container_name: pd-detectron2
    # image:
    build: .
    stdin_open: true
    runtime: nvidia
    shm_size: "3gb"
    tty: true
    restart: always
    command: uvicorn main:app --host 0.0.0.0 --reload
    volumes:
      - .:/code
    ports:
      - '${FASTAPI_LOCAL_PORT}:${FASTAPI_DOCKER_PORT}'

    environment:
      # detectron2 env
      POINT_DUTY_ENV: ${POINT_DUTY_ENV}
      NVIDIA_VISIBLE_DEVICES: all